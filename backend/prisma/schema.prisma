generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

generator doctrine {
  provider = "node ./scripts/prisma-generator/index.js"
  output   = "./temp"
}

enum UserRole {
  admin
  customer
}

model User {
  id                       String                     @id @default(uuid())
  name                     String
  email                    String                     @unique
  role                     UserRole                   @default(customer)
  password                 String
  customerSchedulers       Scheduler[]                @relation("SchedulerCustomer")
  createdAt                DateTime                   @default(now())
}

model Product {
  id                     String          @id @default(uuid())
  name                   String
  description            String?
  price                  Float           @default(0)
  estimatedMinPrice      Float           @default(0)
  estimatedMaxPrice      Float           @default(0)
  bookingLeadTimeMinutes Int             @default(0)
  bookingLeadDays        Int             @default(0)
  schedulerItems         SchedulerItem[]
  createdAt              DateTime        @default(now())
}

model SchedulerItem {
  id String @id @default(uuid())

  schedulerId String
  scheduler   Scheduler @relation("SchedulerItems", fields: [schedulerId], references: [id])

  productId String?
  product   Product? @relation(fields: [productId], references: [id])

  quantity Int @default(1)

  priceAtBooking  Float?
  durationMinutes Int?

  orderIndex Int

  createdAt DateTime @default(now())
}

enum SchedulerStatus {
  pending
  confirmed
  in_progress
  completed
  cancelled
}

model Scheduler {
  id               String          @id @default(uuid())
  customerId       String
  customer         User            @relation("SchedulerCustomer", fields: [customerId], references: [id])
  scheduledAt      DateTime
  estimatedStartAt DateTime?
  estimatedEndAt   DateTime?
  items            SchedulerItem[] @relation("SchedulerItems")
  status           SchedulerStatus @default(pending)
  createdAt        DateTime        @default(now())
}
